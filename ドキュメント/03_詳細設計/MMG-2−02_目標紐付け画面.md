|ID|画面名|URL|
|----|----|----|
|MMG-2-01|新規目標登録画面|/link_goals|

## レイアウト
![レイアウト](../02_基本設計/images/MMG-2-02.jpg)

## 項目一覧
|No|項目名|種類|必須|文字数|文字種|出力|物理名|イベント|画面遷移|補足|
|----|----|----|----|----|----|----|----|----|----|----|
||共通ヘッダー|エリア|-|-|-|-|-|-|-|-|
||画面タイトル|テキスト|-|-|-|-|-|-|-|-|
||目標1|プルダウン|○|-|-|goal.goal_title(valueはid)|goal_id_01|-|-|初期値は`選択してください`|
||目標2|プルダウン|○|-|-|goal.goal_title(valueはid)|goal_id_02|-|-|初期値は`選択してください`|
||登録ボタン|ボタン|-|-|-|-|-|E-10|-|-|



## イベント一覧
### E-00 初期表示
1. ログイン認証
    * 共通処理のログイン認証を呼び出す
        1. 認証結果がFalseの場合
            * ログイン画面にリダイレクトする
        2. 認証結果がTrueの場合
            * 2の処理に進む
2. E-03 目標一覧取得を呼び出す　MMG-1-03 トップページ参照
3. リストをレコードごとに分解する
    ```jinja2
    {% for goal in goals %}
    {% endfor %}
    ```
4. 分解した後の`goal.goal_title`をoptionに配置する
5. 処理終了

### E-10 目標紐付け確定
1. フロント各種チェック
    1. 必須項目チェック
        * 未入力項目がある場合、テキストボックス上に赤文字でアラートを表示する。
        * `必須項目です`
    2. 重複チェック
        * `goal01 == goal02`の場合、目標2のセレクト上に赤文字でアラートを表示する。
        * `異なる目標を選んでください。`
2. 既存紐付けとの重複チェック
    1. 選択した組み合わせをDBに照会し、有無を確認する
        ```SQL
        SELECT COUNT(*) FROM goal_links WHERE goal_id_01 = '{goal_id_01}' and goal_id_02 = '{goal_id_02}' and del_flg = 0;
        ```
        1. 同じ組み合わせがある場合(SQLの結果が1以上)、メッセージを表示して処理を終了する
            `既に紐付けされています`
        2. 同じ組み合わせがない場合(SQLの結果が0)、iiの処理に進む
    2. 選択した組み合わせをDBに照会し、反対の組み合わせの有無を確認する
        ```SQL
        SELECT COUNT(*) FROM goal_links WHERE goal_id_01 = '{goal_id_02}' and goal_id_02 = '{goal_id_01}' and del_flg = 0;
        ```
        1. 反対の組み合わせがある場合(SQLの結果が1以上)、メッセージを表示して処理を終了する
            `既に紐付けされています`
        2. 反対の組み合わせがない場合(SQLの結果が0)、3の処理に進む
3. 紐付けを実施
    1. SQLを実施
        ```SQL
        INSERT INTO goal_links (goal_id_01,goal_id_02,created_at, updated_at) 
        VALUES ('{goal_id_01}','{goal0_id_2}',NOW(),NOW());
        ```
    2. レコードの作成に成功したらTrue,それ以外はFalseを返却する
        1. 返却値がTrue:成功の場合
            * 画面をリロードし、紐付けに成功したメッセージを表示する
            * `目標登録に成功しました`
        2. False:失敗の場合
            * 予期せぬエラーが発生したメッセージを表示する
            * `予期せぬエラーが発生しました`
4. 処理終了